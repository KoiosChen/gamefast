{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% import "_macros.html" as macros %}


{% block subheader %}
    <div class="m-subheader ">
        <div class="d-flex align-items-center">
            <div class="mr-auto">
                <h3 class="m-subheader__title m-subheader__title--separator">
                    业务管理
                </h3>
                <ul class="m-subheader__breadcrumbs m-nav m-nav--inline">
                    <li class="m-nav__item m-nav__item--home">
                        <a href="#" class="m-nav__link m-nav__link--icon">
                            <i class="m-nav__link-icon la la-home"></i>
                        </a>
                    </li>
                    <li class="m-nav__separator">
                        -
                    </li>
                    <li class="m-nav__item">
                        <a href="" class="m-nav__link">
											<span class="m-nav__link-text">
												业务管理
											</span>
                        </a>
                    </li>
                    <li class="m-nav__separator">
                        -
                    </li>
                    <li class="m-nav__item">
                        <a href="" class="m-nav__link">
											<span class="m-nav__link-text">
												邮件管理
											</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
{% endblock %}


{% block pagecontent %}
    <div class="m-portlet m-portlet--success m-portlet--head-solid-bg">
        <div class="m-portlet__head">
            <div class="m-portlet__head-caption">
                <div class="m-portlet__head-title">
                    <h3 class="m-portlet__head-text">
                        邮件模板管理
                    </h3>
                </div>
            </div>
            <div class="m-portlet__head-tools">
                <ul class="m-portlet__nav">
                    <li class="m-portlet__nav-item">
                        <a id="newOne" class="m-portlet__nav-link m-portlet__nav-link--icon">
                            <i class="flaticon-add"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="m-portlet__body">
            <div class="m-portlet__body">
                <div class="m_datatable" id="ajax_data"></div>
            </div>
        </div>
    </div>


    <!-- NEW ONE 模态框（Modal） -->
    <div class="modal fade" id="new_templet_model" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modal_templet_name">
                        新增邮件模板
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
											<span aria-hidden="true">
												&times;
											</span>
                    </button>
                </div>
                <form class="m-form m-form--fit m-form--label-align-right" id="m_form_new_templet">
                    <p id="hid" hidden></p>
                    <div class="modal-body">
                        <div class="m-form__content">
                            <div class="m-alert m-alert--icon alert alert-danger m--hide" role="alert"
                                 id="m_form_new_templet_msg">
                                <div class="m-alert__icon">
                                    <i class="la la-warning"></i>
                                </div>
                                <div class="m-alert__text">
                                    填写信息有误，请检查重填后再次提交！
                                </div>
                                <div class="m-alert__close">
                                    <button type="button" class="close" data-close="alert" aria-label="Close"></button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group m-form__group row">
                            <label class="col-form-label col-lg-3 col-sm-12">
                                模板名称 *
                            </label>
                            <div class="col-lg-6 col-md-9 col-sm-12">
                                <input type="text" class="form-control m-input" name="templet_name"
                                       placeholder="请输入模板名称" data-toggle="m-tooltip" id="templet_name">
                            </div>
                        </div>
                        <div class="form-group m-form__group row">
                            <label class="col-form-label col-lg-3 col-sm-12">
                                模板描述
                            </label>
                            <div class="col-lg-6 col-md-9 col-sm-12">
                                <textarea class="form-control m-input" id="templet_desc" rows="3"></textarea>
                            </div>

                        </div>
                        <div class="form-group m-form__group row">
                            <label class="col-form-label col-lg-3 col-sm-12">
                                上传文件 *
                            </label>
                            <div class="col-lg-6 col-md-9 col-sm-12">
                                <div class="m-dropzone dropzone m-dropzone--success dz-clickable"
                                     action="update_mail_templet" id="m-dropzone-three">
                                    <div class="m-dropzone__msg dz-message needsclick">
                                        <h3 class="m-dropzone__msg-title">
                                            拖动文件至此或点击上传.
                                        </h3>
                                        <span class="m-dropzone__msg-desc">
														仅允许WORD文件
													</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <input class="btn btn-default" id="submit" name="submit" value="提交" type="submit">
                    </div>
                </form>

                <div class="holder">
                </div>
                <ul class="posts" id="itemContainer">
                </ul>
                <div class="holder">
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal -->
    </div>
    <!-- 模态框（Modal）end -->
    <input type="file" multiple="multiple" class="dz-hidden-input"
           accept=".doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document"
           style="visibility: hidden; position: absolute; top: 0px; left: 0px; height: 0px; width: 0px;">
{% endblock %}

{% block scripts %}
    {{ super() }}

    <script>

        $("#new_templet_model").on("hidden.bs.modal", function () {
            $(this).removeData("bs.modal");
        });

        $("#newOne").click(function () {
            $("#modal_templet_name").html('新增模板');
            $("#templet_name").val("");
            $("#templet_desc").val("");
            $("#templet_name").attr('readonly', false);
            $('#m_form_new_templet_msg').addClass('m--hide').hide();
            $("div.form-control-feedback").remove();
            $("#new_templet_model").removeData("bs.modal").modal('show');
        });


        function editInfo(id, templet_name, templet_desc) {
            $('#m_form_new_templet_msg').addClass('m--hide').hide();
            $("div.form-control-feedback").remove();
            $('#modal_templet_name').html("模板管理");
            $('#hid').html(id);
            $('#templet_name').val(templet_name);
            $('#templet_desc').val(templet_desc);
            $('#templet_name').attr('readonly', true);
        }

        function HTMerDel(temlet_id) {
            if (confirm("确定要禁用该模板吗？")) {
                let params = {'temlet_id': temlet_id};
                $.ajax({
                    type: "POST",          //提交方式          
                    url: "disable_templet",  //提交的页面/方法名          
                    data: JSON.stringify(params, null, '\t'),         //参数（如果没有参数：null）          
                    contentType: "application/json; charset=utf-8",
                    success: function (msg) {
                        if (msg.status === 'OK') {
                            toastr.info(msg.content);
                            $('#ajax_data').mDatatable().destroy();
                            DatatableRemoteAjaxMailTemplet.init();

                        } else {
                            toastr.warning(msg.content);
                        }

                    },
                    error: function (xhr, msg, e) {
                        toastr.warning("删除失败");
                    }
                });
            } else {
                toastr.warning('取消删除')
            }
        }

        function HTMerEnable(temlet_id) {
            if (confirm("确定要启用此模板？")) {
                let params = {'temlet_id': temlet_id};
                $.ajax({
                    type: "POST",          //提交方式          
                    url: "enable_templet",  //提交的页面/方法名          
                    data: JSON.stringify(params, null, '\t'),         //参数（如果没有参数：null）          
                    contentType: "application/json; charset=utf-8",
                    success: function (msg) {
                        if (msg.status === 'OK') {
                            toastr.info(msg.content);
                            $('#ajax_data').mDatatable().destroy();
                            DatatableRemoteAjaxMailTemplet.init();

                        } else {
                            toastr.warning(msg.content);
                        }

                    },
                    error: function (xhr, msg, e) {
                        toastr.warning("禁用失败");
                    }
                });
            }
        }


        $(function () {
            //参数设置，若用默认值可以省略以下面代
            toastr.options = {
                "closeButton": true, //是否显示关闭按钮
                "debug": false, //是否使用debug模式
                "progressBar": false,
                "positionClass": "toast-bottom-center",//弹出窗的位置
                "showDuration": "300",//显示的动画时间
                "hideDuration": "1000",//消失的动画时间
                "timeOut": "5000", //展现时间
                "extendedTimeOut": "1000",//加长展示时间
                "showEasing": "swing",//显示时的动画缓冲方式
                "hideEasing": "linear",//消失时的动画缓冲方式
                "showMethod": "fadeIn",//显示时的动画方式
                "hideMethod": "fadeOut" //消失时的动画方式
            };
        })
    </script>
    <script src="../static/metronic/mail/form-controls-mailtemplet.js"></script>
    <script src="../static/metronic/mail/query_mailtemplet_data.js" type="text/javascript"></script>
    <script src="../static/metronic-default/assets/demo/default/custom/components/forms/widgets/dropzone.js"
            type="text/javascript"></script>
{% endblock %}